package fernuni.propra.algorithm;

import java.util.Iterator;
import java.util.LinkedList;
import java.util.List;

import fernuni.propra.algorithm.util.Rectangle;
import fernuni.propra.internal_data_model.IRoom;
import fernuni.propra.internal_data_model.Point;
import fernuni.propra.internal_data_model.Wall;

public class CandidateSearcher  implements ICandidateSearcher{
	private WallContainerEast wallContainerEast  = new WallContainerEast();
	private WallContainerNorth wallContainerNorth = new WallContainerNorth();
	private WallContainerWest wallContainerWest = new WallContainerWest();
	private WallContainerSouth wallContainerSouth = new WallContainerSouth();
	private List<Rectangle> originalRectangles = new LinkedList<Rectangle>();
	
	public CandidateSearcher(IRoom room, IRuntimeCandidateSearcher runtimeCandidateSearcher) {
		this.room = room;
	}
	
	

	@Override
	public List<Point> searchCandidates(IRoom room, IRuntimeCandidateSearcher runtimeCandidateSearcher) throws CandidateSearcherException {
		
		
		try {
			sortWallsToContainers(room);
			
			constructOriginalPartialRectangles();
			
			
		} catch (WallContainerException  wce) {
			throw new CandidateSearcherException(wce);
		}
		
		return null;	
		
	}



	void sortWallsToContainers(IRoom room) throws WallContainerException, CandidateSearcherException {
		Iterator<Wall> wallIterator = room.getWalls();
		while(wallIterator.hasNext()) {
			Wall nextWall = wallIterator.next();
			if (nextWall.isEastWall()) {
				wallContainerEast.add(nextWall);
			} else if (nextWall.isNorthWall()) {
				wallContainerNorth.add(nextWall);
			} else if (nextWall.isWestWall()) {
				wallContainerWest.add(nextWall);
			} else if (nextWall.isSouthWall()) {
				wallContainerSouth.add(nextWall);
			} else {
				throw new CandidateSearcherException("Wall orientation cannot be determined!");
			}
		}
	}
	
	void constructOriginalPartialRectangles() throws WallContainerException {
		
		for( Wall northWall : wallContainerNorth) {
			double yNorth = northWall.getP1().getY();
			double westXLimit = northWall.getP2().getX();
			double eastXLimit = northWall.getP1().getX();
			
			Wall nextWestWall = wallContainerWest.getNearestWall(yNorth, 
					yNorth, westXLimit);
			
			Wall nextEastWall = wallContainerEast.getNearestWall(yNorth, yNorth, eastXLimit);
			
			double xWest = nextWestWall.getP1().getX();
			double xEast = nextEastWall.getP1().getX();
			
			Wall nextSouthWall = wallContainerSouth.getNearestWall(xWest, xEast, yNorth);
			double ySouth = nextSouthWall.getP1().getY();
			
			
			Point southWestCorner = new Point(xWest,ySouth);
			Point northEastCorner = new Point(xEast,yNorth);
			Rectangle partialRectangle = new Rectangle(southWestCorner, northEastCorner);
			
			originalRectangles.add(partialRectangle);
		}
		
		for (Wall eastWall: wallContainerEast) {
			double xEast = eastWall.getP1().getX();
			double southYLimit = eastWall.getP1().getY();
			double northYLimit = eastWall.getP2().getY();
			
			Wall nextSouthWall = wallContainerSouth.getNearestWall(xEast, xEast, southYLimit);
			Wall nextNorthWall = wallContainerNorth.getNearestWall(xEast, xEast, northYLimit);
			
			double ySouth = nextSouthWall.getP1().getY();
			double yNorth = nextNorthWall.getP1().getY();
			
			Wall nextWestWall = wallContainerWest.getNearestWall(ySouth, yNorth, xEast);
			double xWest = nextWestWall.getP1().getX();
			
			Point southWestCorner = new Point(xWest,ySouth);
			Point northEastCorner = new Point(xEast,yNorth);
			Rectangle partialRectangle = new Rectangle(southWestCorner, northEastCorner);
			originalRectangles.add(partialRectangle);
		}
		
		
		for (Wall westWall: wallContainerWest) {
			double xWest = westWall.getP1().getX();
			double southYLimit = westWall.getP2().getY();
			double northYLimit = westWall.getP1().getY();
			
			Wall nextSouthWall = wallContainerSouth.getNearestWall(xWest, xWest, southYLimit);
			Wall nextNorthWall = wallContainerNorth.getNearestWall(xWest, xWest, northYLimit);
			
			double ySouth = nextSouthWall.getP1().getY();
			double yNorth = nextNorthWall.getP1().getY();
			
			Wall nextEastWall = wallContainerEast.getNearestWall(ySouth, yNorth, xWest);
			double xEast = nextEastWall.getP1().getX();
			
			Point southWestCorner = new Point(xWest,ySouth);
			Point northEastCorner = new Point(xEast,yNorth);
			Rectangle partialRectangle = new Rectangle(southWestCorner, northEastCorner);
			originalRectangles.add(partialRectangle);
		}
		
		for (Wall southWall: wallContainerSouth) {
			double ySouth = southWall.getP1().getY();
			double eastXLimit = southWall.getP2().getX();
			double westXLimit = southWall.getP1().getX();
			
			Wall nextEastWall = wallContainerEast.getNearestWall(ySouth, ySouth, eastXLimit);
			Wall nextWestWall = wallContainerWest.getNearestWall(ySouth, ySouth, westXLimit);
			
			double xEast = nextEastWall.getP1().getX();
			double xWest = nextWestWall.getP1().getX();
			
			Wall nextNorthWall = wallContainerNorth.getNearestWall(xEast, xWest, ySouth);
			double yNorth = nextNorthWall.getP1().getY();
			
			Point southWestCorner = new Point(xWest,ySouth);
			Point northEastCorner = new Point(xEast,yNorth);
			Rectangle partialRectangle = new Rectangle(southWestCorner, northEastCorner);
			originalRectangles.add(partialRectangle);
		}	

	}
	
	public Iterator<Rectangle> getIteratorOriginalRectangles() {
		return originalRectangles.iterator();
	}

}
